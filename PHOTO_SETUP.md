# üì∑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –±—ç–∫–µ–Ω–¥–µ

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤:

```bash
cd AccountingForRepairsBackend
npm install multer @types/multer
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫

```bash
mkdir -p uploads/repairs
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ - –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `repair_photos` –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ API

### –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

#### `POST /api/repairs/:id/photos`
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞:
```json
{
  "photos": [
    {
      "filename": "camera-2024-01-15T10-30-45.jpg",
      "url": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAA..."
    }
  ]
}
```

#### `GET /api/repairs/:id/photos/:filename` ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ - **—Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã**

#### `DELETE /api/repairs/:id/photos/:photoId`
–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

#### `GET /api/repairs` –∏ `GET /api/repairs/:id`
–¢–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç –º–∞—Å—Å–∏–≤ `photos` –≤ –æ—Ç–≤–µ—Ç–µ:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "device_type": "smartphone",
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    "photos": [
      {
        "id": 1,
        "repair_id": 1,
        "filename": "photo1.jpg",
        "url": "/api/repairs/1/photos/photo1.jpg",
        "uploaded_at": "2024-01-15 10:30:45"
      }
    ]
  }
}
```

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `repair_photos`:

```sql
CREATE TABLE repair_photos (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  repair_id INTEGER NOT NULL,
  filename TEXT NOT NULL,
  file_path TEXT NOT NULL,
  uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  uploaded_by INTEGER,
  FOREIGN KEY (repair_id) REFERENCES repairs (id) ON DELETE CASCADE,
  FOREIGN KEY (uploaded_by) REFERENCES users (id)
);
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö

### ‚úÖ **–ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê**

**–ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫:**
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ —Ä–∞–∑–¥–∞–≤–∞–ª–∏—Å—å —Å–µ—Ä–≤–µ—Ä–æ–º
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω middleware –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏ –≤ `src/index.ts`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏: `/api/repairs/{id}/photos/{filename}`
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç JSON –¥–æ 10mb –¥–ª—è base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å `/api` –∫–æ –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º
- ‚úÖ –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π endpoint –∏–∑ `routes/repairs.ts`

### –ù–æ–≤—ã–π middleware –≤ `src/index.ts`:
```javascript
// Static files for photo uploads
app.use('/api/repairs', (req, res, next) => {
  const photoMatch = req.path.match(/^\/(\d+)\/photos\/(.+)$/);
  if (photoMatch) {
    const [, repairId, filename] = photoMatch;
    const filePath = path.join(process.cwd(), 'uploads', 'repairs', repairId, filename);
    res.sendFile(filePath, (err) => {
      if (err) {
        res.status(404).json({ success: false, error: 'Photo not found' });
      }
    });
  } else {
    next();
  }
});
```

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–π** - —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- **Base64 –∑–∞–≥—Ä—É–∑–∫–∞** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç base64, –±—ç–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∫ —Ñ–∞–π–ª—ã
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–º–µ–Ω–∞** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- **–ü—Ä–æ—Å—Ç—ã–µ URL** - –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ API

### –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `uploads/repairs/{repair_id}/`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ JPEG —Ñ–æ—Ä–º–∞—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–∫–∏ –∑–∞–≥—Ä—É–∑–æ–∫, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é:

1. ‚úÖ **–§—Ä–æ–Ω—Ç–µ–Ω–¥** - –≥–æ—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. ‚úÖ **–ë—ç–∫–µ–Ω–¥ API** - –≥–æ—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é  
3. ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –≥–æ—Ç–æ–≤–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
4. ‚úÖ **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
5. ‚úÖ **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã** - **–ò–°–ü–†–ê–í–õ–ï–ù–û!** üéâ

**–ü—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `multer`, —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `uploads` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üì∑‚ú®**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏:
1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–º–æ–Ω—Ç —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:3001/api/repairs/1/photos/filename.jpg`
3. –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:
```
uploads/
‚îî‚îÄ‚îÄ repairs/
    ‚îî‚îÄ‚îÄ 1/
        ‚îú‚îÄ‚îÄ camera-2024-01-15T10-30-45.jpg
        ‚îî‚îÄ‚îÄ photo-2024-01-15T11-15-22.jpg
``` 